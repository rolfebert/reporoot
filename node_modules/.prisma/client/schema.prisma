generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int            @id @default(autoincrement())
  email         String         @unique
  passwordHash  String
  createdAt     DateTime       @default(now())
  refreshTokens RefreshToken[]
  items         Item[]
}

model RefreshToken {
  id        Int      @id @default(autoincrement())
  token     String   @unique
  user      User     @relation(fields: [userId], references: [id])
  userId    Int
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([userId])
}

model Item {
  id      Int         @id @default(autoincrement())
  title   String
  content String?     @db.Text
  owner   User        @relation(fields: [ownerId], references: [id])
  ownerId Int
  images  ItemImage[]

  nbsCode          String?
  division         String?
  section          Int?
  sectionName      String?
  age              String?
  backType         String?
  pictorialSubject String?
  pattern          String?
  usageType        String?

  material        String?
  size            String?
  diameter        String?
  color           String?
  holes           Int?
  style           String?
  buttonCondition String?
  manufacturer    String?
  notes           String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([ownerId])
}

model ItemImage {
  id     Int  @id @default(autoincrement())
  item   Item @relation(fields: [itemId], references: [id], onDelete: Cascade)
  itemId Int

  url String?

  imageData        Bytes?  @db.LongBlob
  contentType      String?
  fileSize         Int?
  imageHash        String? @unique
  originalFilename String?
  analysisData     String? @db.Text

  label      String?
  imageOrder Int      @default(0)
  createdAt  DateTime @default(now())

  @@index([itemId])
  @@index([imageHash])
}
